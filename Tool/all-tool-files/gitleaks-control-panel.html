<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitLeaks Control Panel - Easy Security Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-panel {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-container {
            margin-bottom: 30px;
        }

        .step {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .step-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.completed {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .project-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .project-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .project-card h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .project-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .logs {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .log-line {
            margin-bottom: 5px;
        }

        .log-line.success {
            color: #4ec9b0;
        }

        .log-line.error {
            color: #f48771;
        }

        .log-line.info {
            color: #569cd6;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí GitLeaks Control Panel</h1>
            <p>Deploy security scanning to all your projects in minutes</p>
        </div>

        <div class="main-panel">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('quick-start')">üöÄ Quick Start</button>
                <button class="tab" onclick="showTab('single-project')">üì¶ Single Project</button>
                <button class="tab" onclick="showTab('bulk-deploy')">üéØ Bulk Deploy</button>
                <button class="tab" onclick="showTab('github-org')">üè¢ GitHub Org</button>
                <button class="tab" onclick="showTab('dashboard')">üìä Dashboard</button>
            </div>

            <!-- Quick Start Tab -->
            <div id="quick-start" class="tab-content active">
                <div class="alert alert-info">
                    <strong>üëã Welcome!</strong> Choose your deployment method below based on your needs.
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value">2 min</div>
                        <div class="stat-label">Setup Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Projects Protected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Simple Steps</div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px;">Choose Your Method:</h2>

                <div class="project-list">
                    <div class="project-card">
                        <h3>üéØ Single Project</h3>
                        <p>Perfect for getting started or testing on one repository</p>
                        <button class="btn" onclick="showTab('single-project')">Start ‚Üí</button>
                    </div>

                    <div class="project-card">
                        <h3>‚ö° Bulk Deploy</h3>
                        <p>Deploy to multiple projects at once (5-50 projects)</p>
                        <button class="btn" onclick="showTab('bulk-deploy')">Deploy ‚Üí</button>
                    </div>

                    <div class="project-card">
                        <h3>üè¢ Organization</h3>
                        <p>Deploy to all repositories in your GitHub organization</p>
                        <button class="btn" onclick="showTab('github-org')">Setup ‚Üí</button>
                    </div>
                </div>

                <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h3>Need Help Choosing?</h3>
                    <ul style="margin-left: 20px; margin-top: 10px; line-height: 2;">
                        <li><strong>1-3 projects:</strong> Use Single Project method</li>
                        <li><strong>4-50 projects:</strong> Use Bulk Deploy</li>
                        <li><strong>50+ projects:</strong> Use GitHub Organization</li>
                        <li><strong>Want to test first:</strong> Start with Single Project</li>
                    </ul>
                </div>
            </div>

            <!-- Single Project Tab -->
            <div id="single-project" class="tab-content">
                <h2 style="margin-bottom: 20px;">Deploy to Single Project</h2>
                
                <div class="alert alert-info">
                    <strong>üöÄ Two Ways to Deploy:</strong>
                    <br>‚Ä¢ <strong>Automatic:</strong> Enter project path and click deploy (recommended)
                    <br>‚Ä¢ <strong>Manual:</strong> Download files and add them yourself
                </div>

                <!-- AUTOMATIC DEPLOYMENT (NEW!) -->
                <div class="step" style="background: #e8f5e9; border-left: 4px solid #4caf50;">
                    <div class="step-header">
                        <div class="step-number" style="background: #4caf50;">‚ö°</div>
                        <div class="step-title">Automatic Deployment (Recommended)</div>
                    </div>
                    <div class="step-description">
                        Enter your project path and let the control panel do everything automatically!
                    </div>
                    
                    <div class="input-group">
                        <label>Project Path:</label>
                        <input type="text" id="single-project-path" placeholder="~/projects/my-project or /Users/you/dev/my-app">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Examples: ~/projects/my-app, /home/user/repos/project, C:\Users\Name\projects\app
                        </small>
                    </div>
                    
                    <button class="btn btn-success" onclick="deploySingleAuto()">üöÄ Deploy Now (Automatic)</button>
                    
                    <div id="auto-deploy-result" style="margin-top: 15px; display: none;"></div>
                </div>

                <div style="text-align: center; padding: 20px; color: #999; font-weight: bold;">
                    ‚Äî OR ‚Äî
                </div>

                <!-- MANUAL DEPLOYMENT -->
                <div class="step-container">
                    <h3 style="margin-bottom: 15px; color: #666;">Manual Deployment (3 Steps)</h3>
                    
                    <!-- Step 1 -->
                    <div class="step">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">Download Setup Files</div>
                            <span class="status pending" id="step1-status">Pending</span>
                        </div>
                        <div class="step-description">
                            Download the configuration files for your project
                        </div>
                        <button class="btn" onclick="downloadFiles('single')">Download Files</button>
                        <button class="btn btn-secondary" onclick="generateFiles('single')">Generate Custom Files</button>
                    </div>

                    <!-- Step 2 -->
                    <div class="step">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">Add Files to Project</div>
                            <span class="status pending" id="step2-status">Pending</span>
                        </div>
                        <div class="step-description">
                            Copy the downloaded files to your project root directory
                        </div>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
<pre>cd /path/to/your/project

# Extract downloaded files here
unzip gitleaks-config.zip

# Your project should now have:
# .github/workflows/security.yml
# .pre-commit-config.yaml
# .gitleaks.toml</pre>
                        </div>
                        <button class="btn" onclick="markStepComplete(2)">I've Added the Files</button>
                    </div>

                    <!-- Step 3 -->
                    <div class="step">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">Commit and Push</div>
                            <span class="status pending" id="step3-status">Pending</span>
                        </div>
                        <div class="step-description">
                            Commit the configuration files and push to GitHub
                        </div>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
<pre>git add .github .pre-commit-config.yaml .gitleaks.toml
git commit -m "Add GitLeaks security scanning"
git push</pre>
                        </div>
                        <button class="btn btn-success" onclick="markStepComplete(3)">Done! üéâ</button>
                    </div>
                </div>

                <div class="alert alert-success" style="display: none;" id="single-success">
                    <strong>‚úÖ Success!</strong> GitLeaks is now active on your project. Check the Actions tab on GitHub to see the scan results.
                </div>
            </div>

            <!-- Bulk Deploy Tab -->
            <div id="bulk-deploy" class="tab-content">
                <h2 style="margin-bottom: 20px;">Bulk Deploy to Multiple Projects</h2>

                <div class="alert alert-warning">
                    <strong>Note:</strong> This will deploy GitLeaks to all selected projects at once.
                </div>

                <div class="step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">Add Your Projects</div>
                    </div>
                    <div class="input-group">
                        <label>Project Paths (one per line):</label>
                        <textarea id="project-paths" rows="8" placeholder="~/projects/project1
~/projects/project2
/Users/you/dev/project3"></textarea>
                    </div>
                    <button class="btn" onclick="scanProjects()">Scan Projects</button>
                </div>

                <div id="project-scan-results" style="display: none;">
                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Found Projects:</h3>
                    <div id="project-list-container"></div>

                    <div style="margin-top: 30px;">
                        <button class="btn btn-success" onclick="deployBulk()">Deploy to All Projects</button>
                        <button class="btn btn-secondary" onclick="downloadBulkScript()">Download Script Instead</button>
                    </div>
                </div>

                <div id="bulk-logs" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Deployment Progress:</h3>
                    <div class="logs">
                        <div id="bulk-log-content"></div>
                    </div>
                </div>
            </div>

            <!-- GitHub Org Tab -->
            <div id="github-org" class="tab-content">
                <h2 style="margin-bottom: 20px;">Deploy to GitHub Organization or Personal Account</h2>

                <div class="alert alert-info">
                    Deploy to all repositories in your GitHub organization or personal account automatically
                    <br><br>
                    <strong>Works with:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>‚úÖ Personal GitHub accounts (your username)</li>
                        <li>‚úÖ Organization accounts (company/team name)</li>
                    </ul>
                </div>

                <div class="step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">GitHub Configuration</div>
                    </div>
                    
                    <div class="input-group">
                        <label>GitHub Personal Access Token:</label>
                        <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Need a token? <a href="https://github.com/settings/tokens/new" target="_blank">Create one here</a> 
                            (needs <strong>'repo'</strong> and <strong>'workflow'</strong> scopes)
                        </small>
                    </div>

                    <div class="input-group">
                        <label>GitHub Username or Organization Name:</label>
                        <input type="text" id="org-name" placeholder="your-username or your-org-name">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Enter your GitHub username (e.g., <strong>amr-dev</strong>) or organization name (e.g., <strong>my-company</strong>)
                            <br>
                            Find it at: <code>https://github.com/<strong>YOUR-USERNAME</strong></code>
                        </small>
                    </div>

                    <button class="btn" onclick="fetchOrgRepos()">Fetch Repositories</button>
                </div>

                <div id="org-repos" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Repositories in Organization:</h3>
                    <div id="org-repo-list"></div>

                    <div style="margin-top: 30px;">
    <div class="input-group">
        <label>
            <input type="checkbox" id="select-all-repos" onchange="toggleAllRepos()"> Select All Repositories
        </label>
    </div>
    <div class="input-group">
        <label>
            <input type="checkbox" id="dry-run" checked> Dry Run (preview only)
        </label>
    </div>
    <button class="btn btn-success" onclick="deployToOrg()">Deploy to Selected</button>
</div>
                </div>

                <div id="org-logs" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Deployment Logs:</h3>
                    <div class="logs">
                        <div id="org-log-content"></div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <h2 style="margin-bottom: 20px;">Deployment Dashboard</h2>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-projects">0</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="protected-projects">0</div>
                        <div class="stat-label">Protected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pending-projects">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">Verification Checklist:</h3>
                <ul class="checklist">
                    <li>
                        <input type="checkbox" id="check1">
                        <label>GitLeaks workflow files created</label>
                    </li>
                    <li>
                        <input type="checkbox" id="check2">
                        <label>Pre-commit configuration added</label>
                    </li>
                    <li>
                        <input type="checkbox" id="check3">
                        <label>GitHub Actions running successfully</label>
                    </li>
                    <li>
                        <input type="checkbox" id="check4">
                        <label>Branch protection rules enabled</label>
                    </li>
                    <li>
                        <input type="checkbox" id="check5">
                        <label>Team members trained</label>
                    </li>
                </ul>

                <div style="margin-top: 30px;">
                    <button class="btn" onclick="exportReport()">Export Report</button>
                    <button class="btn btn-secondary" onclick="resetDashboard()">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Copy code to clipboard
        function copyCode(btn) {
            const codeBlock = btn.parentElement;
            const code = codeBlock.querySelector('pre').textContent;
            navigator.clipboard.writeText(code);
            
            btn.textContent = 'Copied!';
            setTimeout(() => {
                btn.textContent = 'Copy';
            }, 2000);
        }

        // Download files
        function downloadFiles(type) {
            // Trigger download from API
            window.location.href = 'http://localhost:5000/api/download-config';
            markStepComplete(1);
        }

        // Deploy single project automatically
        function deploySingleAuto() {
            const path = document.getElementById('single-project-path').value.trim();
            const resultDiv = document.getElementById('auto-deploy-result');
            
            if (!path) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'alert alert-warning';
                resultDiv.innerHTML = '<strong>‚ö†Ô∏è Error:</strong> Please enter a project path';
                return;
            }
            
            // Show loading state
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-info';
            resultDiv.innerHTML = '<strong>‚è≥ Deploying...</strong> Please wait...';
            
            // Call API
            fetch('http://localhost:5000/api/deploy-single', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ path: path })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'alert alert-success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Success!</strong> GitLeaks deployed to: ${path}
                        <br><br>
                        <strong>Files created:</strong>
                        <ul style="margin: 10px 0 0 20px;">
                            <li>.github/workflows/security.yml</li>
                            <li>.pre-commit-config.yaml</li>
                            <li>.gitleaks.toml</li>
                        </ul>
                        <br>
                        <strong>Next steps:</strong>
                        <div class="code-block" style="margin-top: 10px;">
<pre>cd ${path}
git add .github .pre-commit-config.yaml .gitleaks.toml
git commit -m "Add GitLeaks security scanning"
git push</pre>
                        </div>
                    `;
                    
                    // Show success on main page too
                    document.getElementById('single-success').style.display = 'block';
                } else {
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong> ${data.message}`;
                }
            })
            .catch(error => {
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = `
                    <strong>‚ùå Error:</strong> Could not connect to API server.
                    <br><br>
                    <strong>Make sure:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>Docker is running: <code>docker compose ps</code></li>
                        <li>API is running: <code>curl http://localhost:5000/api/health</code></li>
                    </ul>
                    <br>
                    <strong>Error details:</strong> ${error.message}
                `;
            });
        }

        // Generate configuration files
        function generateConfigFiles() {
            const files = {
                'security.yml': `name: Security Scan

on:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

permissions:
  contents: read
  security-events: write

jobs:
  gitleaks:
    name: Scan for Secrets
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run GitLeaks
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
          GITLEAKS_ENABLE_SUMMARY: true`,
          
                '.pre-commit-config.yaml': `repos:
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.20.1
    hooks:
      - id: gitleaks`,
      
                '.gitleaks.toml': `# GitLeaks Configuration
# This config uses default rules and minimal allowlist
# to catch secrets effectively

title = "GitLeaks Security Scan"

[extend]
useDefault = true

[allowlist]
description = "Allowlist for known false positives only"

# Only ignore example/template files
paths = [
  '''\.env\.example$''',
  '''\.env\.template$''',
  '''\.env\.sample$''',
]

# Ignore common false positive patterns
regexes = [
  '''example\.com''',
  '''placeholder''',
  '''your-.*-here''',
  '''xxx+''',
]

# No commits ignored - scan everything
commits = []`
            };
            
            // In production, this would create actual files
            console.log('Generated files:', files);
        }

        // Mark step as complete
        function markStepComplete(stepNumber) {
            const steps = document.querySelectorAll('.step');
            const step = steps[stepNumber - 1];
            const status = step.querySelector('.status');
            status.textContent = 'Completed';
            status.classList.remove('pending');
            status.classList.add('completed');
            
            if (stepNumber === 3) {
                document.getElementById('single-success').style.display = 'block';
            }
        }

        // Scan projects
        function scanProjects() {
            const paths = document.getElementById('project-paths').value.trim().split('\n');
            const container = document.getElementById('project-list-container');
            container.innerHTML = '';
            
            paths.forEach((path, index) => {
                if (path.trim()) {
                    const card = document.createElement('div');
                    card.className = 'project-card';
                    card.innerHTML = `
                        <h3>Project ${index + 1}</h3>
                        <p>${path}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span class="status pending">Ready</span>
                    `;
                    container.appendChild(card);
                }
            });
            
            document.getElementById('project-scan-results').style.display = 'block';
        }

        // Deploy bulk
        function deployBulk() {
            const logContainer = document.getElementById('bulk-log-content');
            document.getElementById('bulk-logs').style.display = 'block';
            
            logContainer.innerHTML = '<div class="log-line info">Starting deployment...</div>';
            
            const projects = document.querySelectorAll('#project-list-container .project-card');
            
            projects.forEach((project, index) => {
                setTimeout(() => {
                    const progressBar = project.querySelector('.progress-fill');
                    const status = project.querySelector('.status');
                    
                    // Simulate deployment
                    progressBar.style.width = '50%';
                    logContainer.innerHTML += `<div class="log-line info">Deploying to project ${index + 1}...</div>`;
                    
                    setTimeout(() => {
                        progressBar.style.width = '100%';
                        status.textContent = 'Deployed';
                        status.classList.remove('pending');
                        status.classList.add('completed');
                        logContainer.innerHTML += `<div class="log-line success">‚úì Project ${index + 1} deployed successfully</div>`;
                    }, 1000);
                }, index * 2000);
            });
        }

        // Fetch org repos
        function fetchOrgRepos() {
            const token = document.getElementById('github-token').value.trim();
            const org = document.getElementById('org-name').value.trim();
            
            if (!token || !org) {
                alert('Please provide both GitHub token and organization name');
                return;
            }
            
            // Show loading state
            const repoList = document.getElementById('org-repo-list');
            repoList.innerHTML = '<div class="alert alert-info">üîÑ Fetching repositories from GitHub...</div>';
            document.getElementById('org-repos').style.display = 'block';
            
            // Call the API
            fetch('http://localhost:5000/api/github-org/repos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: token,
                    organization: org
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.repos && data.repos.length > 0) {
                    repoList.innerHTML = `<div class="alert alert-success">‚úÖ Found ${data.repos.length} repositories</div>`;
                    
                    data.repos.forEach(repo => {
                        const card = document.createElement('div');
                        card.className = 'project-card';
                        card.innerHTML = `
                            <h3>
                                <input type="checkbox" data-repo="${repo.full_name}" class="repo-checkbox"> 
                                ${repo.name}
                            </h3>
                            <p>
                                ${repo.private ? 'üîí Private' : 'üåç Public'} ‚Ä¢ 
                                Branch: ${repo.default_branch} ‚Ä¢ 
                                Updated: ${new Date(repo.updated_at).toLocaleDateString()}
                            </p>
                            <span class="status pending">Not Protected</span>
                        `;
                        repoList.appendChild(card);
                    });
                } else if (data.success && data.repos && data.repos.length === 0) {
                    repoList.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è No repositories found in this organization</div>';
                } else {
                    repoList.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${data.message || 'Failed to fetch repositories'}</div>`;
                }
            })
            .catch(error => {
                repoList.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>‚ùå Error connecting to API</strong><br><br>
                        <strong>Make sure:</strong>
                        <ul style="margin: 10px 0 0 20px;">
                            <li>Docker is running: <code>docker compose ps</code></li>
                            <li>API is running: <code>curl http://localhost:5000/api/health</code></li>
                            <li>GitHub token is valid and has correct permissions</li>
                            <li>Organization name is correct</li>
                        </ul>
                        <br>
                        <strong>Error details:</strong> ${error.message}
                    </div>
                `;
            });
        }

        // Deploy to org
        function deployToOrg() {
            const token = document.getElementById('github-token').value.trim();
            const dryRun = document.getElementById('dry-run').checked;
            const logContainer = document.getElementById('org-log-content');
            
            // Get selected repos
            const selectedRepos = [];
            document.querySelectorAll('#org-repo-list input[type="checkbox"]:checked').forEach(cb => {
                selectedRepos.push(cb.getAttribute('data-repo'));
            });
            
            if (selectedRepos.length === 0) {
                alert('Please select at least one repository');
                return;
            }
            
            // Show logs
            document.getElementById('org-logs').style.display = 'block';
            logContainer.innerHTML = `<div class="log-line info">${dryRun ? 'üß™ DRY RUN MODE - No changes will be made' : 'üöÄ LIVE DEPLOYMENT - This will modify repositories'}</div>`;
            logContainer.innerHTML += `<div class="log-line info">Deploying to ${selectedRepos.length} repositories...</div><br>`;
            
            // Call API
            fetch('http://localhost:5000/api/github-org/deploy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: token,
                    repos: selectedRepos,
                    dry_run: dryRun
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.results) {
                    let successCount = 0;
                    let skippedCount = 0;
                    let failedCount = 0;
                    
                    data.results.forEach((result, index) => {
                        setTimeout(() => {
                            let icon = '‚è≥';
                            let className = 'info';
                            let message = result.message;
                            
                            if (result.success) {
                                if (result.skipped) {
                                    icon = '‚è≠Ô∏è';
                                    className = 'info';
                                    skippedCount++;
                                } else {
                                    icon = '‚úÖ';
                                    className = 'success';
                                    successCount++;
                                }
                            } else {
                                icon = '‚ùå';
                                className = 'error';
                                failedCount++;
                            }
                            
                            logContainer.innerHTML += `<div class="log-line ${className}">${icon} ${result.repo}: ${message}</div>`;
                            
                            // Update status in UI
                            const repoCards = document.querySelectorAll('#org-repo-list .project-card');
                            repoCards.forEach(card => {
                                const checkbox = card.querySelector('input[type="checkbox"]');
                                if (checkbox.getAttribute('data-repo') === result.repo) {
                                    const status = card.querySelector('.status');
                                    if (result.success && !result.skipped) {
                                        status.textContent = dryRun ? 'Would Deploy' : 'Deployed';
                                        status.classList.remove('pending');
                                        status.classList.add('completed');
                                    }
                                }
                            });
                            
                            // Show summary at the end
                            if (index === data.results.length - 1) {
                                setTimeout(() => {
                                    logContainer.innerHTML += `<br><div class="log-line info">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>`;
                                    logContainer.innerHTML += `<div class="log-line success"><strong>üìä Summary:</strong></div>`;
                                    logContainer.innerHTML += `<div class="log-line success">‚úÖ Successful: ${successCount}</div>`;
                                    if (skippedCount > 0) {
                                        logContainer.innerHTML += `<div class="log-line info">‚è≠Ô∏è  Skipped: ${skippedCount}</div>`;
                                    }
                                    if (failedCount > 0) {
                                        logContainer.innerHTML += `<div class="log-line error">‚ùå Failed: ${failedCount}</div>`;
                                    }
                                    logContainer.innerHTML += `<div class="log-line success">üì¶ Total: ${data.results.length}</div>`;
                                }, 500);
                            }
                        }, index * 500);
                    });
                } else {
                    logContainer.innerHTML += `<div class="log-line error">‚ùå Error: ${data.message || 'Unknown error'}</div>`;
                }
            })
            .catch(error => {
                logContainer.innerHTML += `
                    <div class="log-line error">
                        <strong>‚ùå Error connecting to API</strong><br>
                        ${error.message}
                    </div>
                `;
            });
        }

        // Download bulk script
        function downloadBulkScript() {
            alert('Script would be downloaded here');
        }

        // Export report
        function exportReport() {
            alert('Report exported successfully!');
        }

        // Toggle all repositories selection
function toggleAllRepos() {
    const selectAllCheckbox = document.getElementById('select-all-repos');
    const repoCheckboxes = document.querySelectorAll('.repo-checkbox');
    
    repoCheckboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
}

        // Reset dashboard
        function resetDashboard() {
            if (confirm('Are you sure you want to reset all data?')) {
                document.querySelectorAll('.checklist input[type="checkbox"]').forEach(cb => cb.checked = false);
                alert('Dashboard reset!');
            }
        }
    </script>
</body>
</html>
